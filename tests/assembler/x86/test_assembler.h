/*
 * Permission is hereby granted, free of charge, to any human obtaining a copy of this software and associated documentation files
 * (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify,
 * merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit humans to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
 * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
 * LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
 * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */

#ifndef ğ”œğ”„â„­ğ”ˆ_ğ”„ğ”–ğ”–ğ”ˆğ”ğ”…ğ”ğ”ˆâ„œ_ğ”›86_ğ”—ğ”ˆğ”–ğ”—_ğ”„ğ”–ğ”–ğ”ˆğ”ğ”…ğ”ğ”ˆâ„œ_â„Œ
#define ğ”œğ”„â„­ğ”ˆ_ğ”„ğ”–ğ”–ğ”ˆğ”ğ”…ğ”ğ”ˆâ„œ_ğ”›86_ğ”—ğ”ˆğ”–ğ”—_ğ”„ğ”–ğ”–ğ”ˆğ”ğ”…ğ”ğ”ˆâ„œ_â„Œ

#include "yace/foundation.h"

#include "yace/assembler/x86/byte_emit_assembler.h"

namespace ğ˜†ğ—®ğ—°ğ—²::ğ˜…ğŸ´ğŸ² {

// Assembler made for testing.  Supplied â€œemitâ‚ˆâ€ function compares expected output to what assembler it generating.
// Since we are knowing all the data in advance it's much simpler than ğ’„ğ’ğ’ğ’”ğ’•ğ’†ğ’™ğ’‘ğ’“_ğ’‚ğ’”ğ’”ğ’†ğ’ğ’ƒğ’ğ’†ğ’“ which helps with compilation speed.
// Note: it's ğ—»ğ—¼ğ˜ a descendant of ğ’ƒğ’šğ’•ğ’†_ğ’†ğ’ğ’Šğ’•_ğ’‚ğ’”ğ’”ğ’†ğ’ğ’ƒğ’ğ’†ğ’“, instead it's function â€œexpected_fromâ€ returns such assembler.
// This allows us to separate std::array container from â€œiteratorâ€ object.  Note that this doesn't work if we are dealing with
// constexprs.
template <
    typename ğ“ªğ“¼ğ“¼ğ“®ğ“¶ğ“«ğ“µğ“®ğ“»,
    auto ğ“¸ğ“¹ğ“½ğ“²ğ“¸ğ“·ğ“¼ = &::ğ˜†ğ—®ğ—°ğ—²::ğ¨ğ©ğ­ğ¢ğ¨ğ§ğ¬::ğ”¡ğ”¢ğ”£ğ”ğ”²ğ”©ğ”±,
    ğœğ¨ğ§ğ¬ğ­ğğ±ğ©ğ«_ğŸğ«ğ¢ğğ§ğğ¥ğ² ğ“¬ğ“¸ğ“·ğ“¼ğ“½ğ“®ğ”ğ“¹ğ“»_ğ“¯ğ“»ğ“²ğ“®ğ“·ğ“­ğ“µğ”‚ = ğ” ğ”¬ğ”«ğ”°ğ”±ğ”¢ğ”µğ”­ğ”¯_ğ”²ğ”«ğ”£ğ”¯ğ”¦ğ”¢ğ”«ğ”¡ğ”©ğ”¶,
    ğ¬ğ¢ğ³ğ ğ“ªğ“¼ğ“¼ğ“®ğ“¶ğ“«ğ“µğ“®ğ“»_ğ“¼ğ“²ğ”ƒğ“® = std::numeric_limits<ğ¬ğ¢ğ³ğ>::max()>
class ğ’ƒğ’‚ğ’”ğ’Šğ’„_ğ’•ğ’†ğ’”ğ’•_ğ’‚ğ’”ğ’”ğ’†ğ’ğ’ƒğ’ğ’†ğ’“ {
  using â’® = ğ’ƒğ’‚ğ’”ğ’Šğ’„_ğ’•ğ’†ğ’”ğ’•_ğ’‚ğ’”ğ’”ğ’†ğ’ğ’ƒğ’ğ’†ğ’“<ğ“ªğ“¼ğ“¼ğ“®ğ“¶ğ“«ğ“µğ“®ğ“», ğ“¸ğ“¹ğ“½ğ“²ğ“¸ğ“·ğ“¼, ğ“¬ğ“¸ğ“·ğ“¼ğ“½ğ“®ğ”ğ“¹ğ“»_ğ“¯ğ“»ğ“²ğ“®ğ“·ğ“­ğ“µğ”‚, ğ“ªğ“¼ğ“¼ğ“®ğ“¶ğ“«ğ“µğ“®ğ“»_ğ“¼ğ“²ğ”ƒğ“®>;
  // Since we are only doing checks it doesn't make much sense to work with them disabled.
  static_assert(ğ“¸ğ“¹ğ“½ğ“²ğ“¸ğ“·ğ“¼->sanity_checks);

 public:
  ğ–ğ–†ğ–ˆğ–Š_ğ–‹ğ–”ğ–—ğ–ˆğ–Šğ–ğ–“ğ–‘ğ–ğ–“ğ–Š constexpr auto expected_from() noexcept {
    // Note: even with C++20 we couldn't automatically determine if we are used in constexpr context or not and then select the
    // appropriate type. We can check whether the proper version was used, though.
#ifdef __cpp_lib_is_constant_evaluated
    ğ–ğ–†ğ–ˆğ–Š_ğ–ˆğ–ğ–Šğ–ˆğ–_ğ–Šğ––ğ–šğ–†ğ–‘(ğ“¸ğ“¹ğ“½ğ“²ğ“¸ğ“·ğ“¼, std::is_constant_evaluated(), ğ›ğ¨ğ¨ğ¥(ğ“¬ğ“¸ğ“·ğ“¼ğ“½ğ“®ğ”ğ“¹ğ“»_ğ“¯ğ“»ğ“²ğ“®ğ“·ğ“­ğ“µğ”‚));
#endif
    return typename ğ“ªğ“¼ğ“¼ğ“®ğ“¶ğ“«ğ“µğ“®ğ“»::â’­{ğ–¾ğ—‘ğ—‰ğ–¾ğ–¼ğ—ğ–¾ğ–½_ğ–¼ğ—ˆğ—‡ğ—ğ–¾ğ—‡ğ—ğ—Œ};
  }

 protected:
  template <typename... ğ“½ğ”‚ğ“¹ğ“®>
  ğ–ğ–†ğ–ˆğ–Š_ğ–‹ğ–”ğ–—ğ–ˆğ–Šğ–ğ–“ğ–‘ğ–ğ–“ğ–Š explicit constexpr ğ’ƒğ’‚ğ’”ğ’Šğ’„_ğ’•ğ’†ğ’”ğ’•_ğ’‚ğ’”ğ’”ğ’†ğ’ğ’ƒğ’ğ’†ğ’“(ğ“½ğ”‚ğ“¹ğ“®... arg) : ğ–¾ğ—‘ğ—‰ğ–¾ğ–¼ğ—ğ–¾ğ–½_ğ–¼ğ—ˆğ—‡ğ—ğ–¾ğ—‡ğ—ğ—Œ{ğ®ğ¢ğ§ğ­â‚ˆ(arg)...} {
    // Note: we want to be able to pass negative values in some cases (which is convenient), but don't want to lose precision.
    ğ–ğ–†ğ–ˆğ–Š_ğ–ˆğ–ğ–Šğ–ˆğ–_ğ–Šğ––ğ–šğ–†ğ–‘_ğ–‹ğ–”ğ–‘ğ–‰(ğ“¸ğ“¹ğ“½ğ“²ğ“¸ğ“·ğ“¼, ğ®ğ¢ğ§ğ­â‚ˆ(arg), std::make_unsigned_t<decltype(arg)>(arg));
  }
  class ğ›ğšğ¬ğ¢ğœ_ğ­ğğ¬ğ­_ğšğ¬ğ¬ğğ¦ğ›ğ¥ğğ«_ğ¯ğğ«ğ¢ğŸğ¢ğğ« : public ğ’ƒğ’šğ’•ğ’†_ğ’†ğ’ğ’Šğ’•_ğ’‚ğ’”ğ’”ğ’†ğ’ğ’ƒğ’ğ’†ğ’“<typename ğ“ªğ“¼ğ“¼ğ“®ğ“¶ğ“«ğ“µğ“®ğ“»::â’­, ğ“¸ğ“¹ğ“½ğ“²ğ“¸ğ“·ğ“¼> {
    using â’® = ğ›ğšğ¬ğ¢ğœ_ğ­ğğ¬ğ­_ğšğ¬ğ¬ğğ¦ğ›ğ¥ğğ«_ğ¯ğğ«ğ¢ğŸğ¢ğğ«;

   public:
    ğ–ğ–†ğ–ˆğ–Š_ğ–‹ğ–”ğ–—ğ–ˆğ–Šğ–ğ–“ğ–‘ğ–ğ–“ğ–Š explicit constexpr operator ğ›ğ¨ğ¨ğ¥() noexcept { return ğ–¾ğ—‘ğ—‰ğ–¾ğ–¼ğ—ğ–¾ğ–½_ğ–¼ğ—ˆğ—‡ğ—ğ–¾ğ—‡ğ—ğ—Œ.size() == ğ—‰ğ—ˆğ—Œğ—‚ğ—ğ—‚ğ—ˆğ—‡; }

   protected:
    ğ–ğ–†ğ–ˆğ–Š_ğ–‹ğ–”ğ–—ğ–ˆğ–Šğ–ğ–“ğ–‘ğ–ğ–“ğ–Š explicit constexpr ğ›ğšğ¬ğ¢ğœ_ğ­ğğ¬ğ­_ğšğ¬ğ¬ğğ¦ğ›ğ¥ğğ«_ğ¯ğğ«ğ¢ğŸğ¢ğğ«(
        const std::array<ğ®ğ¢ğ§ğ­â‚ˆ, ğ“ªğ“¼ğ“¼ğ“®ğ“¶ğ“«ğ“µğ“®ğ“»_ğ“¼ğ“²ğ”ƒğ“®>& expected_contents) noexcept
        : ğ–¾ğ—‘ğ—‰ğ–¾ğ–¼ğ—ğ–¾ğ–½_ğ–¼ğ—ˆğ—‡ğ—ğ–¾ğ—‡ğ—ğ—Œ{expected_contents}, ğ—‰ğ—ˆğ—Œğ—‚ğ—ğ—‚ğ—ˆğ—‡{0} {}
    ğ–ğ–†ğ–ˆğ–Š_ğ–‹ğ–”ğ–—ğ–ˆğ–Šğ–ğ–“ğ–‘ğ–ğ–“ğ–Š constexpr ğ›ğšğ¬ğ¢ğœ_ğ­ğğ¬ğ­_ğšğ¬ğ¬ğğ¦ğ›ğ¥ğğ«_ğ¯ğğ«ğ¢ğŸğ¢ğğ«(
        const std::array<ğ®ğ¢ğ§ğ­â‚ˆ, ğ“ªğ“¼ğ“¼ğ“®ğ“¶ğ“«ğ“µğ“®ğ“»_ğ“¼ğ“²ğ”ƒğ“®>& expected_contents,
        ğ¬ğ¢ğ³ğ position)
        : ğ–¾ğ—‘ğ—‰ğ–¾ğ–¼ğ—ğ–¾ğ–½_ğ–¼ğ—ˆğ—‡ğ—ğ–¾ğ—‡ğ—ğ—Œ{expected_contents}, ğ—‰ğ—ˆğ—Œğ—‚ğ—ğ—‚ğ—ˆğ—‡{position} {}

   private:
    friend ğ’ƒğ’šğ’•ğ’†_ğ’†ğ’ğ’Šğ’•_ğ’‚ğ’”ğ’”ğ’†ğ’ğ’ƒğ’ğ’†ğ’“<typename ğ“ªğ“¼ğ“¼ğ“®ğ“¶ğ“«ğ“µğ“®ğ“»::â’­, ğ“¸ğ“¹ğ“½ğ“²ğ“¸ğ“·ğ“¼>;
    ğ–ğ–†ğ–ˆğ–Š_ğ–‹ğ–”ğ–—ğ–ˆğ–Šğ–ğ–“ğ–‘ğ–ğ–“ğ–Š constexpr decltype(auto) emitâ‚ˆ(ğ®ğ¢ğ§ğ­â‚ˆ value) {
      ğ–ğ–†ğ–ˆğ–Š_ğ–ˆğ–ğ–Šğ–ˆğ–_ğ–‡ğ–Šğ–‘ğ–”ğ–œ(ğ“¸ğ“¹ğ“½ğ“²ğ“¸ğ“·ğ“¼, ğ—‰ğ—ˆğ—Œğ—‚ğ—ğ—‚ğ—ˆğ—‡, ğ–¾ğ—‘ğ—‰ğ–¾ğ–¼ğ—ğ–¾ğ–½_ğ–¼ğ—ˆğ—‡ğ—ğ–¾ğ—‡ğ—ğ—Œ.size());
      ğ–ğ–†ğ–ˆğ–Š_ğ–ˆğ–ğ–Šğ–ˆğ–_ğ–Šğ––ğ–šğ–†ğ–‘(ğ“¸ğ“¹ğ“½ğ“²ğ“¸ğ“·ğ“¼, value, ğ–¾ğ—‘ğ—‰ğ–¾ğ–¼ğ—ğ–¾ğ–½_ğ–¼ğ—ˆğ—‡ğ—ğ–¾ğ—‡ğ—ğ—Œ[ğ—‰ğ—ˆğ—Œğ—‚ğ—ğ—‚ğ—ˆğ—‡]);
      return typename ğ“ªğ“¼ğ“¼ğ“®ğ“¶ğ“«ğ“µğ“®ğ“»::â’­{ğ–¾ğ—‘ğ—‰ğ–¾ğ–¼ğ—ğ–¾ğ–½_ğ–¼ğ—ˆğ—‡ğ—ğ–¾ğ—‡ğ—ğ—Œ, ğ—‰ğ—ˆğ—Œğ—‚ğ—ğ—‚ğ—ˆğ—‡ + 1};
    }
    // Note: references are not allowed in costexpr expressions so we need to copy full array if we are dealing with constexpr.
#ifdef __clang__
#pragma clang diagnostic push
#pragma clang diagnostic ignored "-Wpadded"
#endif
    std::conditional_t<ğ›ğ¨ğ¨ğ¥(ğ“¬ğ“¸ğ“·ğ“¼ğ“½ğ“®ğ”ğ“¹ğ“»_ğ“¯ğ“»ğ“²ğ“®ğ“·ğ“­ğ“µğ”‚), const std::array<ğ®ğ¢ğ§ğ­â‚ˆ, ğ“ªğ“¼ğ“¼ğ“®ğ“¶ğ“«ğ“µğ“®ğ“»_ğ“¼ğ“²ğ”ƒğ“®>, const std::array<ğ®ğ¢ğ§ğ­â‚ˆ, ğ“ªğ“¼ğ“¼ğ“®ğ“¶ğ“«ğ“µğ“®ğ“»_ğ“¼ğ“²ğ”ƒğ“®>&>
        ğ–¾ğ—‘ğ—‰ğ–¾ğ–¼ğ—ğ–¾ğ–½_ğ–¼ğ—ˆğ—‡ğ—ğ–¾ğ—‡ğ—ğ—Œ;
    const ğ¬ğ¢ğ³ğ ğ—‰ğ—ˆğ—Œğ—‚ğ—ğ—‚ğ—ˆğ—‡;
#ifdef __clang__
#pragma clang diagnostic pop
#endif
  };

 private:
  const std::array<ğ®ğ¢ğ§ğ­â‚ˆ, ğ“ªğ“¼ğ“¼ğ“®ğ“¶ğ“«ğ“µğ“®ğ“»_ğ“¼ğ“²ğ”ƒğ“®> ğ–¾ğ—‘ğ—‰ğ–¾ğ–¼ğ—ğ–¾ğ–½_ğ–¼ğ—ˆğ—‡ğ—ğ–¾ğ—‡ğ—ğ—Œ;
};

// Similarly to std::span - version with size specified in runtime.
template <typename ğ“ªğ“¼ğ“¼ğ“®ğ“¶ğ“«ğ“µğ“®ğ“», auto ğ“¸ğ“¹ğ“½ğ“²ğ“¸ğ“·ğ“¼, ğœğ¨ğ§ğ¬ğ­ğğ±ğ©ğ«_ğŸğ«ğ¢ğğ§ğğ¥ğ² ğ“¬ğ“¸ğ“·ğ“¼ğ“½ğ“®ğ”ğ“¹ğ“»_ğ“¯ğ“»ğ“²ğ“®ğ“·ğ“­ğ“µğ”‚>
class ğ’ƒğ’‚ğ’”ğ’Šğ’„_ğ’•ğ’†ğ’”ğ’•_ğ’‚ğ’”ğ’”ğ’†ğ’ğ’ƒğ’ğ’†ğ’“<ğ“ªğ“¼ğ“¼ğ“®ğ“¶ğ“«ğ“µğ“®ğ“», ğ“¸ğ“¹ğ“½ğ“²ğ“¸ğ“·ğ“¼, ğ“¬ğ“¸ğ“·ğ“¼ğ“½ğ“®ğ”ğ“¹ğ“»_ğ“¯ğ“»ğ“²ğ“®ğ“·ğ“­ğ“µğ”‚, std::numeric_limits<ğ¬ğ¢ğ³ğ>::max()> {
  using â’® = ğ’ƒğ’‚ğ’”ğ’Šğ’„_ğ’•ğ’†ğ’”ğ’•_ğ’‚ğ’”ğ’”ğ’†ğ’ğ’ƒğ’ğ’†ğ’“<ğ“ªğ“¼ğ“¼ğ“®ğ“¶ğ“«ğ“µğ“®ğ“», ğ“¸ğ“¹ğ“½ğ“²ğ“¸ğ“·ğ“¼, ğ“¬ğ“¸ğ“·ğ“¼ğ“½ğ“®ğ”ğ“¹ğ“»_ğ“¯ğ“»ğ“²ğ“®ğ“·ğ“­ğ“µğ”‚, std::numeric_limits<ğ¬ğ¢ğ³ğ>::max()>;
  // No support for constexpr version here.
  static_assert(ğ“¬ğ“¸ğ“·ğ“¼ğ“½ğ“®ğ”ğ“¹ğ“»_ğ“¯ğ“»ğ“²ğ“®ğ“·ğ“­ğ“µğ”‚ == ğ” ğ”¬ğ”«ğ”°ğ”±ğ”¢ğ”µğ”­ğ”¯_ğ”²ğ”«ğ”£ğ”¯ğ”¦ğ”¢ğ”«ğ”¡ğ”©ğ”¶);
  // Since we are only doing checks it doesn't make much sense to work with them disabled.
  static_assert(ğ“¸ğ“¹ğ“½ğ“²ğ“¸ğ“·ğ“¼->sanity_checks);

 public:
  ğ–ğ–†ğ–ˆğ–Š_ğ–‹ğ–”ğ–—ğ–ˆğ–Šğ–ğ–“ğ–‘ğ–ğ–“ğ–Š constexpr auto expected_from() noexcept {
#ifdef __cpp_lib_span
    return typename ğ“ªğ“¼ğ“¼ğ“®ğ“¶ğ“«ğ“µğ“®ğ“»::â’­{ğ–¾ğ—‘ğ—‰ğ–¾ğ–¼ğ—ğ–¾ğ–½_ğ–¼ğ—ˆğ—‡ğ—ğ–¾ğ—‡ğ—ğ—Œ};
#else
    return typename ğ“ªğ“¼ğ“¼ğ“®ğ“¶ğ“«ğ“µğ“®ğ“»::â’­{ğ–¾ğ—‘ğ—‰ğ–¾ğ–¼ğ—ğ–¾ğ–½_ğ–¼ğ—ˆğ—‡ğ—ğ–¾ğ—‡ğ—ğ—Œ_ğ–»ğ–¾ğ—€ğ—‚ğ—‡, ğ–¾ğ—‘ğ—‰ğ–¾ğ–¼ğ—ğ–¾ğ–½_ğ–¼ğ—ˆğ—‡ğ—ğ–¾ğ—‡ğ—ğ—Œ_ğ–¾ğ—‡ğ–½};
#endif
  }

 protected:
  template <typename ğ“²ğ“½ğ“®ğ“»ğ“ªğ“½ğ“¸ğ“»>
  ğ–ğ–†ğ–ˆğ–Š_ğ–‹ğ–”ğ–—ğ–ˆğ–Šğ–ğ–“ğ–‘ğ–ğ–“ğ–Š constexpr ğ’ƒğ’‚ğ’”ğ’Šğ’„_ğ’•ğ’†ğ’”ğ’•_ğ’‚ğ’”ğ’”ğ’†ğ’ğ’ƒğ’ğ’†ğ’“(ğ“²ğ“½ğ“®ğ“»ğ“ªğ“½ğ“¸ğ“» first, ğ¬ğ¢ğ³ğ count) noexcept
#ifdef __cpp_lib_span
      : ğ–¾ğ—‘ğ—‰ğ–¾ğ–¼ğ—ğ–¾ğ–½_ğ–¼ğ—ˆğ—‡ğ—ğ–¾ğ—‡ğ—ğ—Œ {
    first, count
  }
#else
      : ğ–¾ğ—‘ğ—‰ğ–¾ğ–¼ğ—ğ–¾ğ–½_ğ–¼ğ—ˆğ—‡ğ—ğ–¾ğ—‡ğ—ğ—Œ_ğ–»ğ–¾ğ—€ğ—‚ğ—‡{first}, ğ–¾ğ—‘ğ—‰ğ–¾ğ–¼ğ—ğ–¾ğ–½_ğ–¼ğ—ˆğ—‡ğ—ğ–¾ğ—‡ğ—ğ—Œ_ğ–¾ğ—‡ğ–½ {
    first + count
  }
#endif
  {}
  template <typename ğ“²ğ“½ğ“®ğ“»ğ“ªğ“½ğ“¸ğ“», typename ğ“®ğ“·ğ“­>
  ğ–ğ–†ğ–ˆğ–Š_ğ–‹ğ–”ğ–—ğ–ˆğ–Šğ–ğ–“ğ–‘ğ–ğ–“ğ–Š constexpr ğ’ƒğ’‚ğ’”ğ’Šğ’„_ğ’•ğ’†ğ’”ğ’•_ğ’‚ğ’”ğ’”ğ’†ğ’ğ’ƒğ’ğ’†ğ’“(ğ“²ğ“½ğ“®ğ“»ğ“ªğ“½ğ“¸ğ“» first, ğ“®ğ“·ğ“­ last) noexcept
#ifdef __cpp_lib_span
      : ğ–¾ğ—‘ğ—‰ğ–¾ğ–¼ğ—ğ–¾ğ–½_ğ–¼ğ—ˆğ—‡ğ—ğ–¾ğ—‡ğ—ğ—Œ {
    first, last
  }
#else
      : ğ–¾ğ—‘ğ—‰ğ–¾ğ–¼ğ—ğ–¾ğ–½_ğ–¼ğ—ˆğ—‡ğ—ğ–¾ğ—‡ğ—ğ—Œ_ğ–»ğ–¾ğ—€ğ—‚ğ—‡{first}, ğ–¾ğ—‘ğ—‰ğ–¾ğ–¼ğ—ğ–¾ğ–½_ğ–¼ğ—ˆğ—‡ğ—ğ–¾ğ—‡ğ—ğ—Œ_ğ–¾ğ—‡ğ–½ {
    first + (last - first)
  }
#endif
  {}
  class ğ›ğšğ¬ğ¢ğœ_ğ­ğğ¬ğ­_ğšğ¬ğ¬ğğ¦ğ›ğ¥ğğ«_ğ¯ğğ«ğ¢ğŸğ¢ğğ« : public ğ’ƒğ’šğ’•ğ’†_ğ’†ğ’ğ’Šğ’•_ğ’‚ğ’”ğ’”ğ’†ğ’ğ’ƒğ’ğ’†ğ’“<typename ğ“ªğ“¼ğ“¼ğ“®ğ“¶ğ“«ğ“µğ“®ğ“»::â’­, ğ“¸ğ“¹ğ“½ğ“²ğ“¸ğ“·ğ“¼> {
    using â’® = ğ›ğšğ¬ğ¢ğœ_ğ­ğğ¬ğ­_ğšğ¬ğ¬ğğ¦ğ›ğ¥ğğ«_ğ¯ğğ«ğ¢ğŸğ¢ğğ«;

   public:
    ğ–ğ–†ğ–ˆğ–Š_ğ–‹ğ–”ğ–—ğ–ˆğ–Šğ–ğ–“ğ–‘ğ–ğ–“ğ–Š explicit constexpr operator ğ›ğ¨ğ¨ğ¥() noexcept {
#ifdef __cpp_lib_span
      return ğ–¾ğ—‘ğ—‰ğ–¾ğ–¼ğ—ğ–¾ğ–½_ğ–¼ğ—ˆğ—‡ğ—ğ–¾ğ—‡ğ—ğ—Œ.empty();
#else
      return ğ–¾ğ—‘ğ—‰ğ–¾ğ–¼ğ—ğ–¾ğ–½_ğ–¼ğ—ˆğ—‡ğ—ğ–¾ğ—‡ğ—ğ—Œ_ğ–»ğ–¾ğ—€ğ—‚ğ—‡ == ğ–¾ğ—‘ğ—‰ğ–¾ğ–¼ğ—ğ–¾ğ–½_ğ–¼ğ—ˆğ—‡ğ—ğ–¾ğ—‡ğ—ğ—Œ_ğ–¾ğ—‡ğ–½;
#endif
    }

   protected:
#ifdef __cpp_lib_span
    ğ–ğ–†ğ–ˆğ–Š_ğ–‹ğ–”ğ–—ğ–ˆğ–Šğ–ğ–“ğ–‘ğ–ğ–“ğ–Š explicit constexpr ğ›ğšğ¬ğ¢ğœ_ğ­ğğ¬ğ­_ğšğ¬ğ¬ğğ¦ğ›ğ¥ğğ«_ğ¯ğğ«ğ¢ğŸğ¢ğğ«(const std::span<const ğ®ğ¢ğ§ğ­â‚ˆ> expected_contents) noexcept
        : ğ–¾ğ—‘ğ—‰ğ–¾ğ–¼ğ—ğ–¾ğ–½_ğ–¼ğ—ˆğ—‡ğ—ğ–¾ğ—‡ğ—ğ—Œ{expected_contents} {}
#else
    ğ–ğ–†ğ–ˆğ–Š_ğ–‹ğ–”ğ–—ğ–ˆğ–Šğ–ğ–“ğ–‘ğ–ğ–“ğ–Š explicit constexpr ğ›ğšğ¬ğ¢ğœ_ğ­ğğ¬ğ­_ğšğ¬ğ¬ğğ¦ğ›ğ¥ğğ«_ğ¯ğğ«ğ¢ğŸğ¢ğğ«(
        const ğ®ğ¢ğ§ğ­â‚ˆ* const expected_contents_begin,
        const ğ®ğ¢ğ§ğ­â‚ˆ* const expected_contents_end) noexcept
        : ğ–¾ğ—‘ğ—‰ğ–¾ğ–¼ğ—ğ–¾ğ–½_ğ–¼ğ—ˆğ—‡ğ—ğ–¾ğ—‡ğ—ğ—Œ_ğ–»ğ–¾ğ—€ğ—‚ğ—‡{expected_contents_begin}, ğ–¾ğ—‘ğ—‰ğ–¾ğ–¼ğ—ğ–¾ğ–½_ğ–¼ğ—ˆğ—‡ğ—ğ–¾ğ—‡ğ—ğ—Œ_ğ–¾ğ—‡ğ–½{expected_contents_end} {}
#endif

   private:
    friend ğ’ƒğ’šğ’•ğ’†_ğ’†ğ’ğ’Šğ’•_ğ’‚ğ’”ğ’”ğ’†ğ’ğ’ƒğ’ğ’†ğ’“<typename ğ“ªğ“¼ğ“¼ğ“®ğ“¶ğ“«ğ“µğ“®ğ“»::â’­, ğ“¸ğ“¹ğ“½ğ“²ğ“¸ğ“·ğ“¼>;
    ğ–ğ–†ğ–ˆğ–Š_ğ–‹ğ–”ğ–—ğ–ˆğ–Šğ–ğ–“ğ–‘ğ–ğ–“ğ–Š constexpr decltype(auto) emitâ‚ˆ(ğ®ğ¢ğ§ğ­â‚ˆ value) {
#ifdef __cpp_lib_span
      ğ–ğ–†ğ–ˆğ–Š_ğ–ˆğ–ğ–Šğ–ˆğ–(ğ“¸ğ“¹ğ“½ğ“²ğ“¸ğ“·ğ“¼, not ğ–¾ğ—‘ğ—‰ğ–¾ğ–¼ğ—ğ–¾ğ–½_ğ–¼ğ—ˆğ—‡ğ—ğ–¾ğ—‡ğ—ğ—Œ.empty());
      ğ–ğ–†ğ–ˆğ–Š_ğ–ˆğ–ğ–Šğ–ˆğ–_ğ–Šğ––ğ–šğ–†ğ–‘(ğ“¸ğ“¹ğ“½ğ“²ğ“¸ğ“·ğ“¼, value, ğ–¾ğ—‘ğ—‰ğ–¾ğ–¼ğ—ğ–¾ğ–½_ğ–¼ğ—ˆğ—‡ğ—ğ–¾ğ—‡ğ—ğ—Œ[0]);
      return typename ğ“ªğ“¼ğ“¼ğ“®ğ“¶ğ“«ğ“µğ“®ğ“»::â’­{ğ–¾ğ—‘ğ—‰ğ–¾ğ–¼ğ—ğ–¾ğ–½_ğ–¼ğ—ˆğ—‡ğ—ğ–¾ğ—‡ğ—ğ—Œ.subspan(1)};
#else
      ğ–ğ–†ğ–ˆğ–Š_ğ–ˆğ–ğ–Šğ–ˆğ–_ğ–‡ğ–Šğ–‘ğ–”ğ–œ(ğ“¸ğ“¹ğ“½ğ“²ğ“¸ğ“·ğ“¼, ğ–¾ğ—‘ğ—‰ğ–¾ğ–¼ğ—ğ–¾ğ–½_ğ–¼ğ—ˆğ—‡ğ—ğ–¾ğ—‡ğ—ğ—Œ_ğ–»ğ–¾ğ—€ğ—‚ğ—‡, ğ–¾ğ—‘ğ—‰ğ–¾ğ–¼ğ—ğ–¾ğ–½_ğ–¼ğ—ˆğ—‡ğ—ğ–¾ğ—‡ğ—ğ—Œ_ğ–¾ğ—‡ğ–½);
      // NOLINTNEXTLINE(cppcoreguidelines-pro-bounds-pointer-arithmetic)
      ğ–ğ–†ğ–ˆğ–Š_ğ–ˆğ–ğ–Šğ–ˆğ–_ğ–Šğ––ğ–šğ–†ğ–‘(ğ“¸ğ“¹ğ“½ğ“²ğ“¸ğ“·ğ“¼, value, ğ–¾ğ—‘ğ—‰ğ–¾ğ–¼ğ—ğ–¾ğ–½_ğ–¼ğ—ˆğ—‡ğ—ğ–¾ğ—‡ğ—ğ—Œ_ğ–»ğ–¾ğ—€ğ—‚ğ—‡[0]);
      // NOLINTNEXTLINE(cppcoreguidelines-pro-bounds-pointer-arithmetic)
      return typename ğ“ªğ“¼ğ“¼ğ“®ğ“¶ğ“«ğ“µğ“®ğ“»::â’­{ğ–¾ğ—‘ğ—‰ğ–¾ğ–¼ğ—ğ–¾ğ–½_ğ–¼ğ—ˆğ—‡ğ—ğ–¾ğ—‡ğ—ğ—Œ_ğ–»ğ–¾ğ—€ğ—‚ğ—‡ + 1, ğ–¾ğ—‘ğ—‰ğ–¾ğ–¼ğ—ğ–¾ğ–½_ğ–¼ğ—ˆğ—‡ğ—ğ–¾ğ—‡ğ—ğ—Œ_ğ–¾ğ—‡ğ–½};
#endif
    }
#ifdef __cpp_lib_span
    const std::span<const ğ®ğ¢ğ§ğ­â‚ˆ> ğ–¾ğ—‘ğ—‰ğ–¾ğ–¼ğ—ğ–¾ğ–½_ğ–¼ğ—ˆğ—‡ğ—ğ–¾ğ—‡ğ—ğ—Œ;
#else
    const ğ®ğ¢ğ§ğ­â‚ˆ* const ğ–¾ğ—‘ğ—‰ğ–¾ğ–¼ğ—ğ–¾ğ–½_ğ–¼ğ—ˆğ—‡ğ—ğ–¾ğ—‡ğ—ğ—Œ_ğ–»ğ–¾ğ—€ğ—‚ğ—‡;
    const ğ®ğ¢ğ§ğ­â‚ˆ* const ğ–¾ğ—‘ğ—‰ğ–¾ğ–¼ğ—ğ–¾ğ–½_ğ–¼ğ—ˆğ—‡ğ—ğ–¾ğ—‡ğ—ğ—Œ_ğ–¾ğ—‡ğ–½;
#endif
  };

 private:
#ifdef __cpp_lib_span
  const std::span<const ğ®ğ¢ğ§ğ­â‚ˆ> ğ–¾ğ—‘ğ—‰ğ–¾ğ–¼ğ—ğ–¾ğ–½_ğ–¼ğ—ˆğ—‡ğ—ğ–¾ğ—‡ğ—ğ—Œ;
#else
  const ğ®ğ¢ğ§ğ­â‚ˆ* const ğ–¾ğ—‘ğ—‰ğ–¾ğ–¼ğ—ğ–¾ğ–½_ğ–¼ğ—ˆğ—‡ğ—ğ–¾ğ—‡ğ—ğ—Œ_ğ–»ğ–¾ğ—€ğ—‚ğ—‡;
  const ğ®ğ¢ğ§ğ­â‚ˆ* const ğ–¾ğ—‘ğ—‰ğ–¾ğ–¼ğ—ğ–¾ğ–½_ğ–¼ğ—ˆğ—‡ğ—ğ–¾ğ—‡ğ—ğ—Œ_ğ–¾ğ—‡ğ–½;
#endif
};

template <
    auto ğ“¸ğ“¹ğ“½ğ“²ğ“¸ğ“·ğ“¼ = &::ğ˜†ğ—®ğ—°ğ—²::ğ¨ğ©ğ­ğ¢ğ¨ğ§ğ¬::ğ”¡ğ”¢ğ”£ğ”ğ”²ğ”©ğ”±,
    ğœğ¨ğ§ğ¬ğ­ğğ±ğ©ğ«_ğŸğ«ğ¢ğğ§ğğ¥ğ² ğ“¬ğ“¸ğ“·ğ“¼ğ“½ğ“®ğ”ğ“¹ğ“»_ğ“¯ğ“»ğ“²ğ“®ğ“·ğ“­ğ“µğ”‚ = ğ” ğ”¬ğ”«ğ”°ğ”±ğ”¢ğ”µğ”­ğ”¯_ğ”²ğ”«ğ”£ğ”¯ğ”¦ğ”¢ğ”«ğ”¡ğ”©ğ”¶,
    ğ¬ğ¢ğ³ğ ğ“ªğ“¼ğ“¼ğ“®ğ“¶ğ“«ğ“µğ“®ğ“»_ğ“¼ğ“²ğ”ƒğ“® = std::numeric_limits<ğ¬ğ¢ğ³ğ>::max()>
class ğ’•ğ’†ğ’”ğ’•_ğ’‚ğ’”ğ’”ğ’†ğ’ğ’ƒğ’ğ’†ğ’“ : public ğ’ƒğ’‚ğ’”ğ’Šğ’„_ğ’•ğ’†ğ’”ğ’•_ğ’‚ğ’”ğ’”ğ’†ğ’ğ’ƒğ’ğ’†ğ’“<
                           ğ’•ğ’†ğ’”ğ’•_ğ’‚ğ’”ğ’”ğ’†ğ’ğ’ƒğ’ğ’†ğ’“<ğ“¸ğ“¹ğ“½ğ“²ğ“¸ğ“·ğ“¼, ğ“¬ğ“¸ğ“·ğ“¼ğ“½ğ“®ğ”ğ“¹ğ“»_ğ“¯ğ“»ğ“²ğ“®ğ“·ğ“­ğ“µğ”‚, ğ“ªğ“¼ğ“¼ğ“®ğ“¶ğ“«ğ“µğ“®ğ“»_ğ“¼ğ“²ğ”ƒğ“®>,
                           ğ“¸ğ“¹ğ“½ğ“²ğ“¸ğ“·ğ“¼,
                           ğ“¬ğ“¸ğ“·ğ“¼ğ“½ğ“®ğ”ğ“¹ğ“»_ğ“¯ğ“»ğ“²ğ“®ğ“·ğ“­ğ“µğ”‚,
                           ğ“ªğ“¼ğ“¼ğ“®ğ“¶ğ“«ğ“µğ“®ğ“»_ğ“¼ğ“²ğ”ƒğ“®> {
  using â’« = ğ’ƒğ’‚ğ’”ğ’Šğ’„_ğ’•ğ’†ğ’”ğ’•_ğ’‚ğ’”ğ’”ğ’†ğ’ğ’ƒğ’ğ’†ğ’“<
      ğ’•ğ’†ğ’”ğ’•_ğ’‚ğ’”ğ’”ğ’†ğ’ğ’ƒğ’ğ’†ğ’“<ğ“¸ğ“¹ğ“½ğ“²ğ“¸ğ“·ğ“¼, ğ“¬ğ“¸ğ“·ğ“¼ğ“½ğ“®ğ”ğ“¹ğ“»_ğ“¯ğ“»ğ“²ğ“®ğ“·ğ“­ğ“µğ”‚, ğ“ªğ“¼ğ“¼ğ“®ğ“¶ğ“«ğ“µğ“®ğ“»_ğ“¼ğ“²ğ”ƒğ“®>,
      ğ“¸ğ“¹ğ“½ğ“²ğ“¸ğ“·ğ“¼,
      ğ“¬ğ“¸ğ“·ğ“¼ğ“½ğ“®ğ”ğ“¹ğ“»_ğ“¯ğ“»ğ“²ğ“®ğ“·ğ“­ğ“µğ”‚,
      ğ“ªğ“¼ğ“¼ğ“®ğ“¶ğ“«ğ“µğ“®ğ“»_ğ“¼ğ“²ğ”ƒğ“®>;
  using â’® = ğ’•ğ’†ğ’”ğ’•_ğ’‚ğ’”ğ’”ğ’†ğ’ğ’ƒğ’ğ’†ğ’“<ğ“¸ğ“¹ğ“½ğ“²ğ“¸ğ“·ğ“¼, ğ“¬ğ“¸ğ“·ğ“¼ğ“½ğ“®ğ”ğ“¹ğ“»_ğ“¯ğ“»ğ“²ğ“®ğ“·ğ“­ğ“µğ”‚, ğ“ªğ“¼ğ“¼ğ“®ğ“¶ğ“«ğ“µğ“®ğ“»_ğ“¼ğ“²ğ”ƒğ“®>;

 public:
  template <typename... ğ“½ğ”‚ğ“¹ğ“®>
  ğ–ğ–†ğ–ˆğ–Š_ğ–‹ğ–”ğ–—ğ–ˆğ–Šğ–ğ–“ğ–‘ğ–ğ–“ğ–Š explicit constexpr ğ’•ğ’†ğ’”ğ’•_ğ’‚ğ’”ğ’”ğ’†ğ’ğ’ƒğ’ğ’†ğ’“(ğ“½ğ”‚ğ“¹ğ“®... arg) : â’«{arg...} {}

 private:
  friend class ğ’ƒğ’‚ğ’”ğ’Šğ’„_ğ’•ğ’†ğ’”ğ’•_ğ’‚ğ’”ğ’”ğ’†ğ’ğ’ƒğ’ğ’†ğ’“<
      ğ’•ğ’†ğ’”ğ’•_ğ’‚ğ’”ğ’”ğ’†ğ’ğ’ƒğ’ğ’†ğ’“<ğ“¸ğ“¹ğ“½ğ“²ğ“¸ğ“·ğ“¼, ğ“¬ğ“¸ğ“·ğ“¼ğ“½ğ“®ğ”ğ“¹ğ“»_ğ“¯ğ“»ğ“²ğ“®ğ“·ğ“­ğ“µğ”‚, ğ“ªğ“¼ğ“¼ğ“®ğ“¶ğ“«ğ“µğ“®ğ“»_ğ“¼ğ“²ğ”ƒğ“®>,
      ğ“¸ğ“¹ğ“½ğ“²ğ“¸ğ“·ğ“¼,
      ğ“¬ğ“¸ğ“·ğ“¼ğ“½ğ“®ğ”ğ“¹ğ“»_ğ“¯ğ“»ğ“²ğ“®ğ“·ğ“­ğ“µğ”‚,
      ğ“ªğ“¼ğ“¼ğ“®ğ“¶ğ“«ğ“µğ“®ğ“»_ğ“¼ğ“²ğ”ƒğ“®>;
  friend class â’«::ğ›ğšğ¬ğ¢ğœ_ğ­ğğ¬ğ­_ğšğ¬ğ¬ğğ¦ğ›ğ¥ğğ«_ğ¯ğğ«ğ¢ğŸğ¢ğğ«;
  class ğ­ğğ¬ğ­_ğšğ¬ğ¬ğğ¦ğ›ğ¥ğğ«_ğ¯ğğ«ğ¢ğŸğ¢ğğ« : public â’«::ğ›ğšğ¬ğ¢ğœ_ğ­ğğ¬ğ­_ğšğ¬ğ¬ğğ¦ğ›ğ¥ğğ«_ğ¯ğğ«ğ¢ğŸğ¢ğğ« {
    using â’® = ğ­ğğ¬ğ­_ğšğ¬ğ¬ğğ¦ğ›ğ¥ğğ«_ğ¯ğğ«ğ¢ğŸğ¢ğğ«;

   private:
    friend class ğ’ƒğ’‚ğ’”ğ’Šğ’„_ğ’•ğ’†ğ’”ğ’•_ğ’‚ğ’”ğ’”ğ’†ğ’ğ’ƒğ’ğ’†ğ’“<
        ğ’•ğ’†ğ’”ğ’•_ğ’‚ğ’”ğ’”ğ’†ğ’ğ’ƒğ’ğ’†ğ’“<ğ“¸ğ“¹ğ“½ğ“²ğ“¸ğ“·ğ“¼, ğ“¬ğ“¸ğ“·ğ“¼ğ“½ğ“®ğ”ğ“¹ğ“»_ğ“¯ğ“»ğ“²ğ“®ğ“·ğ“­ğ“µğ”‚, ğ“ªğ“¼ğ“¼ğ“®ğ“¶ğ“«ğ“µğ“®ğ“»_ğ“¼ğ“²ğ”ƒğ“®>,
        ğ“¸ğ“¹ğ“½ğ“²ğ“¸ğ“·ğ“¼,
        ğ“¬ğ“¸ğ“·ğ“¼ğ“½ğ“®ğ”ğ“¹ğ“»_ğ“¯ğ“»ğ“²ğ“®ğ“·ğ“­ğ“µğ”‚,
        ğ“ªğ“¼ğ“¼ğ“®ğ“¶ğ“«ğ“µğ“®ğ“»_ğ“¼ğ“²ğ”ƒğ“®>;
    friend class â’«::ğ›ğšğ¬ğ¢ğœ_ğ­ğğ¬ğ­_ğšğ¬ğ¬ğğ¦ğ›ğ¥ğğ«_ğ¯ğğ«ğ¢ğŸğ¢ğğ«;
    ğ–ğ–†ğ–ˆğ–Š_ğ–‹ğ–”ğ–—ğ–ˆğ–Šğ–ğ–“ğ–‘ğ–ğ–“ğ–Š explicit constexpr ğ­ğğ¬ğ­_ğšğ¬ğ¬ğğ¦ğ›ğ¥ğğ«_ğ¯ğğ«ğ¢ğŸğ¢ğğ«(const std::array<ğ®ğ¢ğ§ğ­â‚ˆ, ğ“ªğ“¼ğ“¼ğ“®ğ“¶ğ“«ğ“µğ“®ğ“»_ğ“¼ğ“²ğ”ƒğ“®>& expected_contents) noexcept
        : â’«::ğ›ğšğ¬ğ¢ğœ_ğ­ğğ¬ğ­_ğšğ¬ğ¬ğğ¦ğ›ğ¥ğğ«_ğ¯ğğ«ğ¢ğŸğ¢ğğ«{expected_contents} {}
    ğ–ğ–†ğ–ˆğ–Š_ğ–‹ğ–”ğ–—ğ–ˆğ–Šğ–ğ–“ğ–‘ğ–ğ–“ğ–Š constexpr ğ­ğğ¬ğ­_ğšğ¬ğ¬ğğ¦ğ›ğ¥ğğ«_ğ¯ğğ«ğ¢ğŸğ¢ğğ«(
        const std::array<ğ®ğ¢ğ§ğ­â‚ˆ, ğ“ªğ“¼ğ“¼ğ“®ğ“¶ğ“«ğ“µğ“®ğ“»_ğ“¼ğ“²ğ”ƒğ“®>& expected_contents,
        ğ¬ğ¢ğ³ğ position) noexcept
        : â’«::ğ›ğšğ¬ğ¢ğœ_ğ­ğğ¬ğ­_ğšğ¬ğ¬ğğ¦ğ›ğ¥ğğ«_ğ¯ğğ«ğ¢ğŸğ¢ğğ«{expected_contents, position} {}
  };
  using â’­ = ğ­ğğ¬ğ­_ğšğ¬ğ¬ğğ¦ğ›ğ¥ğğ«_ğ¯ğğ«ğ¢ğŸğ¢ğğ«;
};

template <auto ğ“¸ğ“¹ğ“½ğ“²ğ“¸ğ“·ğ“¼, ğœğ¨ğ§ğ¬ğ­ğğ±ğ©ğ«_ğŸğ«ğ¢ğğ§ğğ¥ğ² ğ“¬ğ“¸ğ“·ğ“¼ğ“½ğ“®ğ”ğ“¹ğ“»_ğ“¯ğ“»ğ“²ğ“®ğ“·ğ“­ğ“µğ”‚>
class ğ’•ğ’†ğ’”ğ’•_ğ’‚ğ’”ğ’”ğ’†ğ’ğ’ƒğ’ğ’†ğ’“<ğ“¸ğ“¹ğ“½ğ“²ğ“¸ğ“·ğ“¼, ğ“¬ğ“¸ğ“·ğ“¼ğ“½ğ“®ğ”ğ“¹ğ“»_ğ“¯ğ“»ğ“²ğ“®ğ“·ğ“­ğ“µğ”‚, std::numeric_limits<ğ¬ğ¢ğ³ğ>::max()>
    : public ğ’ƒğ’‚ğ’”ğ’Šğ’„_ğ’•ğ’†ğ’”ğ’•_ğ’‚ğ’”ğ’”ğ’†ğ’ğ’ƒğ’ğ’†ğ’“<
          ğ’•ğ’†ğ’”ğ’•_ğ’‚ğ’”ğ’”ğ’†ğ’ğ’ƒğ’ğ’†ğ’“<ğ“¸ğ“¹ğ“½ğ“²ğ“¸ğ“·ğ“¼, ğ“¬ğ“¸ğ“·ğ“¼ğ“½ğ“®ğ”ğ“¹ğ“»_ğ“¯ğ“»ğ“²ğ“®ğ“·ğ“­ğ“µğ”‚, std::numeric_limits<ğ¬ğ¢ğ³ğ>::max()>,
          ğ“¸ğ“¹ğ“½ğ“²ğ“¸ğ“·ğ“¼,
          ğ“¬ğ“¸ğ“·ğ“¼ğ“½ğ“®ğ”ğ“¹ğ“»_ğ“¯ğ“»ğ“²ğ“®ğ“·ğ“­ğ“µğ”‚,
          std::numeric_limits<ğ¬ğ¢ğ³ğ>::max()> {
  using â’« = ğ’ƒğ’‚ğ’”ğ’Šğ’„_ğ’•ğ’†ğ’”ğ’•_ğ’‚ğ’”ğ’”ğ’†ğ’ğ’ƒğ’ğ’†ğ’“<
      ğ’•ğ’†ğ’”ğ’•_ğ’‚ğ’”ğ’”ğ’†ğ’ğ’ƒğ’ğ’†ğ’“<ğ“¸ğ“¹ğ“½ğ“²ğ“¸ğ“·ğ“¼, ğ“¬ğ“¸ğ“·ğ“¼ğ“½ğ“®ğ”ğ“¹ğ“»_ğ“¯ğ“»ğ“²ğ“®ğ“·ğ“­ğ“µğ”‚, std::numeric_limits<ğ¬ğ¢ğ³ğ>::max()>,
      ğ“¸ğ“¹ğ“½ğ“²ğ“¸ğ“·ğ“¼,
      ğ“¬ğ“¸ğ“·ğ“¼ğ“½ğ“®ğ”ğ“¹ğ“»_ğ“¯ğ“»ğ“²ğ“®ğ“·ğ“­ğ“µğ”‚,
      std::numeric_limits<ğ¬ğ¢ğ³ğ>::max()>;
  using â’® = ğ’•ğ’†ğ’”ğ’•_ğ’‚ğ’”ğ’”ğ’†ğ’ğ’ƒğ’ğ’†ğ’“<ğ“¸ğ“¹ğ“½ğ“²ğ“¸ğ“·ğ“¼, ğ“¬ğ“¸ğ“·ğ“¼ğ“½ğ“®ğ”ğ“¹ğ“»_ğ“¯ğ“»ğ“²ğ“®ğ“·ğ“­ğ“µğ”‚, std::numeric_limits<ğ¬ğ¢ğ³ğ>::max()>;

 public:
  template <typename ğ“²ğ“½ğ“®ğ“»ğ“ªğ“½ğ“¸ğ“»>
  ğ–ğ–†ğ–ˆğ–Š_ğ–‹ğ–”ğ–—ğ–ˆğ–Šğ–ğ–“ğ–‘ğ–ğ–“ğ–Š constexpr ğ’•ğ’†ğ’”ğ’•_ğ’‚ğ’”ğ’”ğ’†ğ’ğ’ƒğ’ğ’†ğ’“(ğ“²ğ“½ğ“®ğ“»ğ“ªğ“½ğ“¸ğ“» first, ğ¬ğ¢ğ³ğ count) noexcept : â’«{first, count} {}
  template <typename ğ“²ğ“½ğ“®ğ“»ğ“ªğ“½ğ“¸ğ“», typename ğ“®ğ“·ğ“­>
  ğ–ğ–†ğ–ˆğ–Š_ğ–‹ğ–”ğ–—ğ–ˆğ–Šğ–ğ–“ğ–‘ğ–ğ–“ğ–Š constexpr ğ’•ğ’†ğ’”ğ’•_ğ’‚ğ’”ğ’”ğ’†ğ’ğ’ƒğ’ğ’†ğ’“(ğ“²ğ“½ğ“®ğ“»ğ“ªğ“½ğ“¸ğ“» first, ğ“®ğ“·ğ“­ last) noexcept : â’«{first, last} {}

 private:
  friend class ğ’ƒğ’‚ğ’”ğ’Šğ’„_ğ’•ğ’†ğ’”ğ’•_ğ’‚ğ’”ğ’”ğ’†ğ’ğ’ƒğ’ğ’†ğ’“<
      ğ’•ğ’†ğ’”ğ’•_ğ’‚ğ’”ğ’”ğ’†ğ’ğ’ƒğ’ğ’†ğ’“<ğ“¸ğ“¹ğ“½ğ“²ğ“¸ğ“·ğ“¼, ğ“¬ğ“¸ğ“·ğ“¼ğ“½ğ“®ğ”ğ“¹ğ“»_ğ“¯ğ“»ğ“²ğ“®ğ“·ğ“­ğ“µğ”‚, std::numeric_limits<ğ¬ğ¢ğ³ğ>::max()>,
      ğ“¸ğ“¹ğ“½ğ“²ğ“¸ğ“·ğ“¼,
      ğ“¬ğ“¸ğ“·ğ“¼ğ“½ğ“®ğ”ğ“¹ğ“»_ğ“¯ğ“»ğ“²ğ“®ğ“·ğ“­ğ“µğ”‚,
      std::numeric_limits<ğ¬ğ¢ğ³ğ>::max()>;
  friend class â’«::ğ›ğšğ¬ğ¢ğœ_ğ­ğğ¬ğ­_ğšğ¬ğ¬ğğ¦ğ›ğ¥ğğ«_ğ¯ğğ«ğ¢ğŸğ¢ğğ«;
  class ğ­ğğ¬ğ­_ğšğ¬ğ¬ğğ¦ğ›ğ¥ğğ«_ğ¯ğğ«ğ¢ğŸğ¢ğğ« : public â’«::ğ›ğšğ¬ğ¢ğœ_ğ­ğğ¬ğ­_ğšğ¬ğ¬ğğ¦ğ›ğ¥ğğ«_ğ¯ğğ«ğ¢ğŸğ¢ğğ« {
    using â’® = ğ­ğğ¬ğ­_ğšğ¬ğ¬ğğ¦ğ›ğ¥ğğ«_ğ¯ğğ«ğ¢ğŸğ¢ğğ«;

   private:
    friend class ğ’ƒğ’‚ğ’”ğ’Šğ’„_ğ’•ğ’†ğ’”ğ’•_ğ’‚ğ’”ğ’”ğ’†ğ’ğ’ƒğ’ğ’†ğ’“<
        ğ’•ğ’†ğ’”ğ’•_ğ’‚ğ’”ğ’”ğ’†ğ’ğ’ƒğ’ğ’†ğ’“<ğ“¸ğ“¹ğ“½ğ“²ğ“¸ğ“·ğ“¼, ğ“¬ğ“¸ğ“·ğ“¼ğ“½ğ“®ğ”ğ“¹ğ“»_ğ“¯ğ“»ğ“²ğ“®ğ“·ğ“­ğ“µğ”‚, std::numeric_limits<ğ¬ğ¢ğ³ğ>::max()>,
        ğ“¸ğ“¹ğ“½ğ“²ğ“¸ğ“·ğ“¼,
        ğ“¬ğ“¸ğ“·ğ“¼ğ“½ğ“®ğ”ğ“¹ğ“»_ğ“¯ğ“»ğ“²ğ“®ğ“·ğ“­ğ“µğ”‚,
        std::numeric_limits<ğ¬ğ¢ğ³ğ>::max()>;
    friend class â’«::ğ›ğšğ¬ğ¢ğœ_ğ­ğğ¬ğ­_ğšğ¬ğ¬ğğ¦ğ›ğ¥ğğ«_ğ¯ğğ«ğ¢ğŸğ¢ğğ«;
#ifdef __cpp_lib_span
    ğ–ğ–†ğ–ˆğ–Š_ğ–‹ğ–”ğ–—ğ–ˆğ–Šğ–ğ–“ğ–‘ğ–ğ–“ğ–Š explicit constexpr ğ­ğğ¬ğ­_ğšğ¬ğ¬ğğ¦ğ›ğ¥ğğ«_ğ¯ğğ«ğ¢ğŸğ¢ğğ«(const std::span<const ğ®ğ¢ğ§ğ­â‚ˆ> expected_contents) noexcept
        : â’«::ğ›ğšğ¬ğ¢ğœ_ğ­ğğ¬ğ­_ğšğ¬ğ¬ğğ¦ğ›ğ¥ğğ«_ğ¯ğğ«ğ¢ğŸğ¢ğğ«{expected_contents} {}
#else
    ğ–ğ–†ğ–ˆğ–Š_ğ–‹ğ–”ğ–—ğ–ˆğ–Šğ–ğ–“ğ–‘ğ–ğ–“ğ–Š explicit constexpr ğ­ğğ¬ğ­_ğšğ¬ğ¬ğğ¦ğ›ğ¥ğğ«_ğ¯ğğ«ğ¢ğŸğ¢ğğ«(
        const ğ®ğ¢ğ§ğ­â‚ˆ* const expected_contents_begin,
        const ğ®ğ¢ğ§ğ­â‚ˆ* const expected_contents_end) noexcept
        : â’«::ğ›ğšğ¬ğ¢ğœ_ğ­ğğ¬ğ­_ğšğ¬ğ¬ğğ¦ğ›ğ¥ğğ«_ğ¯ğğ«ğ¢ğŸğ¢ğğ«{expected_contents_begin, expected_contents_end} {}
#endif
  };
  using â’­ = ğ­ğğ¬ğ­_ğšğ¬ğ¬ğğ¦ğ›ğ¥ğğ«_ğ¯ğğ«ğ¢ğŸğ¢ğğ«;
};

template <
    auto ğ“¸ğ“¹ğ“½ğ“²ğ“¸ğ“·ğ“¼ =&::ğ˜†ğ—®ğ—°ğ—²::ğ¨ğ©ğ­ğ¢ğ¨ğ§ğ¬::ğ”ğ”°ğ”°ğ”¢ğ”¯ğ”±,
    ğœğ¨ğ§ğ¬ğ­ğğ±ğ©ğ«_ğŸğ«ğ¢ğğ§ğğ¥ğ² ğ“¬ğ“¸ğ“·ğ“¼ğ“½ğ“®ğ”ğ“¹ğ“»_ğ“¯ğ“»ğ“²ğ“®ğ“·ğ“­ğ“µğ”‚ = ğ” ğ”¬ğ”«ğ”°ğ”±ğ”¢ğ”µğ”­ğ”¯_ğ”£ğ”¯ğ”¦ğ”¢ğ”«ğ”¡ğ”©ğ”¶,
    typename... ğ“½ğ”‚ğ“¹ğ“®>
ğ–ğ–†ğ–ˆğ–Š_ğ–‹ğ–”ğ–—ğ–ˆğ–Šğ–ğ–“ğ–‘ğ–ğ–“ğ–Š constexpr auto ğ‘¡ğ‘’ğ‘ ğ‘¡_ğ‘ğ‘ ğ‘ ğ‘’ğ‘šğ‘ğ‘™ğ‘’ğ‘Ÿ(ğ“½ğ”‚ğ“¹ğ“®... arg) {
  return ğ’•ğ’†ğ’”ğ’•_ğ’‚ğ’”ğ’”ğ’†ğ’ğ’ƒğ’ğ’†ğ’“<ğ“¸ğ“¹ğ“½ğ“²ğ“¸ğ“·ğ“¼, ğ“¬ğ“¸ğ“·ğ“¼ğ“½ğ“®ğ”ğ“¹ğ“»_ğ“¯ğ“»ğ“²ğ“®ğ“·ğ“­ğ“µğ”‚, sizeof...(ğ“½ğ”‚ğ“¹ğ“®)>(arg...);
}

}  // namespace ğ˜†ğ—®ğ—°ğ—²::ğ˜…ğŸ´ğŸ²

#endif  // ğ”œğ”„â„­ğ”ˆ_ğ”„ğ”–ğ”–ğ”ˆğ”ğ”…ğ”ğ”ˆâ„œ_ğ”›86_ğ”—ğ”ˆğ”–ğ”—_ğ”„ğ”–ğ”–ğ”ˆğ”ğ”…ğ”ğ”ˆâ„œ_â„Œ
